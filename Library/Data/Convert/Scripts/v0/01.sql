----------------------------------------------------

CREATE TABLE APPVERSION (
	MAJOR SMALLINT NOT NULL,
	MINOR SMALLINT NOT NULL,
	BUILD SMALLINT NOT NULL,
	DT datetime NOT NULL DEFAULT GETDATE()
);

----------------------------------------------------

CREATE TABLE APPUSERS (
  ID BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
  USERNAME VARCHAR(256) NOT NULL,
  NORMALIZEDUSERNAME VARCHAR(256) NOT NULL,
  NAME VARCHAR(256),    
  EMAIL VARCHAR(256) DEFAULT NULL,
  NORMALIZEDEMAIL VARCHAR(256) DEFAULT NULL,
  EMAILCONFIRMED SMALLINT,  
  PASSWORDHASH VARCHAR(256),
  SECURITYSTAMP VARCHAR(256),
  CONCURRENCYSTAMP VARCHAR(256), 
  PHONENUMBER VARCHAR(256) DEFAULT NULL,
  PHONENUMBERCONFIRMED SMALLINT,
  TWOFACTORENABLED  SMALLINT,
  LOCKOUTEND DATE NULL,
  LOCKOUTENABLED SMALLINT,
  ACCESSFAILEDCOUNT INT NULL
);

CREATE UNIQUE INDEX IX_APPUSERS_NORMALIZEDUSERNAME ON APPUSERS	
(NORMALIZEDUSERNAME);

----------------------------------------------------

CREATE TABLE APPUSERCLAIMS ( 
  ID INT IDENTITY(1,1) PRIMARY KEY NOT NULL,
  CLAIMTYPE VARCHAR(256) NULL,
  CLAIMVALUE VARCHAR(256) NULL,
  USERID BIGINT
);

CREATE INDEX IX_APPUSERCLAIMS_USERID ON APPUSERCLAIMS	
(USERID);

ALTER TABLE APPUSERCLAIMS
  ADD CONSTRAINT FK_APPUSERCLAIMS_APPUSERS_USER_ID FOREIGN KEY (USERID) REFERENCES APPUSERS (ID)
  ON DELETE CASCADE;

  ----------------------------------------------------

CREATE TABLE APPUSERLOGINS ( 
  USERID BIGINT,
  LOGINPROVIDER VARCHAR(128) NOT NULL,
  PROVIDERKEY VARCHAR(128) NOT NULL,
  PROVIDERDISPLAYNAME TEXT NULL,
  CONSTRAINT PK_APPUSERLOGINS PRIMARY KEY (USERID, LOGINPROVIDER, PROVIDERKEY)
);

CREATE INDEX IX_APPUSERLOGINS_USERID ON APPUSERLOGINS	
(USERID);

ALTER TABLE APPUSERLOGINS
  ADD CONSTRAINT FK_APPUSERLOGINS_APPUSERS_USERID FOREIGN KEY (USERID) REFERENCES APPUSERS (ID)
  ON DELETE CASCADE;

----------------------------------------------------

CREATE TABLE APPUSERTOKENS ( 
  USERID BIGINT,
  LOGINPROVIDER VARCHAR(128) NOT NULL,
  NAME VARCHAR(128) NOT NULL,
  VALUE TEXT NULL,
  CONSTRAINT PK_APPUSERTOKENS PRIMARY KEY (USERID, LOGINPROVIDER, NAME)
);

CREATE INDEX IX_APPUSERTOKENS_USERID ON APPUSERTOKENS	
(USERID);

ALTER TABLE APPUSERTOKENS
  ADD CONSTRAINT FK_APPUSERTOKENS_APPUSERS_USERID FOREIGN KEY (USERID) REFERENCES APPUSERS (ID)
  ON DELETE CASCADE;

----------------------------------------------------

CREATE TABLE APPROLES ( 
  ID INT PRIMARY KEY NOT NULL,
  NAME VARCHAR(256) NOT NULL,
  NORMALIZEDNAME VARCHAR(256) NOT NULL,
  CONCURRENCYSTAMP VARCHAR(256)
);

CREATE UNIQUE INDEX IX_APPROLES_NORMALIZEDNAME ON APPROLES	
(NORMALIZEDNAME);

----------------------------------------------------

CREATE TABLE APPROLECLAIMS ( 
  ID INT IDENTITY(1,1) PRIMARY KEY NOT NULL,
  CLAIMTYPE VARCHAR(256) NULL,
  CLAIMVALUE VARCHAR(256) NULL,
  ROLEID INT
);

CREATE INDEX IX_APPROLECLAIMS_ROLEID ON APPROLECLAIMS	
(ROLEID);

ALTER TABLE APPROLECLAIMS
  ADD CONSTRAINT FK_APPROLECLAIMS_APPROLES_ROLEID FOREIGN KEY (ROLEID) REFERENCES APPROLES (ID)
  ON DELETE CASCADE;

----------------------------------------------------

CREATE TABLE APPUSERROLES ( 
  USERID BIGINT,
  ROLEID INT,
  CONSTRAINT PK_APPUSERROLES PRIMARY KEY (USERID, ROLEID)
);

CREATE INDEX IX_APPUSERROLES_ROLEID	ON APPUSERROLES	
(ROLEID);
CREATE INDEX IX_APPUSERROLES_USERID	ON APPUSERROLES	
(USERID);

ALTER TABLE APPUSERROLES
  ADD CONSTRAINT FK_APPUSERROLES_APPROLES_ROLEID FOREIGN KEY (ROLEID) REFERENCES APPROLES (ID)
  ON DELETE CASCADE;

ALTER TABLE APPUSERROLES
  ADD CONSTRAINT FK_APPUSERROLES_APPUSERS_USERID FOREIGN KEY (USERID) REFERENCES APPUSERS (ID)
  ON DELETE CASCADE;

----------------------------------------------------